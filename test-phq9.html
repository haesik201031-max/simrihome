<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>PHQ-9 (우울 검사)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f6f8fb;color:#111}
  .wrap{max-width:900px;margin:0 auto;padding:32px}
  h1{font-size:28px;margin:8px 0 16px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:22px 20px;margin:14px 0;box-shadow:0 6px 16px rgba(17,24,39,.06)}
  .q{margin:0 0 12px;font-weight:600}
  .opts label{display:block;margin:6px 0;padding:8px 10px;border-radius:10px;border:1px solid #e5e7eb;cursor:pointer}
  .btn{display:inline-block;background:#1668e3;color:#fff;border:0;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;margin-top:10px}
  .result{background:#eef5ff;border:1px solid #cfe2ff;border-radius:12px;padding:16px 18px;margin-top:16px;font-size:16px}
  .muted{color:#667085}
  .topnav{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  a.home{color:#1668e3;text-decoration:none;font-weight:600}
  .counsel-btn{display:none;text-align:center;margin-top:20px}
  .counsel-btn button{background:#e53935;color:#fff;font-size:18px;font-weight:700;border:0;border-radius:12px;padding:16px 28px;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <div class="topnav">
    <div class="muted">마음건강 자가검진</div>
    <a class="home" href="index.html">← 메인으로</a>
  </div>
  <h1>PHQ-9 (우울 검사)</h1>
  <p class="muted">지난 2주 동안 얼마나 자주 해당 상황을 경험했는지 선택하세요.</p>

  <form id="form"></form>

  <div>
    <button class="btn" id="submitBtn" type="button">결과 확인</button>
    <div id="out" class="result" style="display:none"></div>
  </div>

  <div class="counsel-btn" id="counselDiv">
    <button onclick="window.location.href='counsel.html'" type="button">상담 신청하기</button>
  </div>
</div>

<script>
const q = [
  "일에 흥미나 즐거움을 느끼지 못했다",
  "우울하거나, 침울하거나, 희망이 없다고 느꼈다",
  "잠들기 어렵거나 자주 깼다, 혹은 너무 많이 잤다",
  "피곤하거나 기운이 거의 없었다",
  "식욕이 없거나 과식을 했다",
  "자신이 나쁜 사람이라거나 실패자라고 느꼈다",
  "신문 읽기나 TV 시청 같은 일상적인 일에도 집중할 수 없었다",
  "남들이 눈치 챌 정도로 느리게 움직이거나 말이 느려졌다 / 반대로 안절부절 못하며 많이 움직였다",
  "차라리 죽는 게 낫겠다고 생각했거나 자해할 생각을 했다"
];

const labels = ["전혀 아님(0)", "며칠 동안(1)", "일주일 이상(2)", "거의 매일(3)"];

const form = document.getElementById('form');
q.forEach((t,i)=>{
  const box = document.createElement('div'); box.className='card';
  box.innerHTML = `
    <div class="q">${i+1}. ${t}</div>
    <div class="opts">
      ${labels.map((lb,idx)=>`
        <label><input type="radio" name="q${i}" value="${idx}" required/> ${lb}</label>
      `).join('')}
    </div>`;
  form.append(box);
});

function score(){
  let s=0,c=0;
  q.forEach((_,i)=>{
    const sel=form.querySelector(\`input[name="q\${i}"]:checked\`);
    if(!sel) return; s+=Number(sel.value); c++;
  });
  if(c!==q.length) return null;
  return s; // 0~27
}

document.getElementById('submitBtn').addEventListener('click', ()=>{
  const sc=score();
  const out=document.getElementById('out');
  if(sc===null){ alert('모든 문항을 선택해 주세요.'); return; }

  let guide="";
  if(sc<=4){ guide="정상 범위: 특별한 우울 증상은 보이지 않습니다."; }
  else if(sc<=9){ guide="가벼운 우울: 스트레스 관리와 자기돌봄이 필요합니다."; }
  else if(sc<=14){ guide="중간 정도 우울: 주의 깊은 관찰과 상담 권장."; }
  else if(sc<=19){ guide="중등도~중증 우울: 적극적인 상담 및 치료 필요."; }
  else { guide="심한 우울: 즉각적인 전문 상담·치료가 필요합니다."; }

  out.style.display='block';
  out.innerHTML=\`<b>총점: \${sc}점 (0~27)</b><br/><span>\${guide}</span>\`;
  document.getElementById('counselDiv').style.display='block';

  // localStorage 불러오기
  const name=localStorage.getItem('name')||'';
  const gender=localStorage.getItem('gender')||'';
  const age=localStorage.getItem('age')||'';
  const location=localStorage.getItem('location')||'';

  // 구글폼 전송
  sendToGoogleForm({
    name, gender, age, location,
    testName:"PHQ-9",
    score:sc,
    result:guide
  });
});

function sendToGoogleForm(data){
  const url="https://docs.google.com/forms/d/e/1FAIpQLSc3C7dxR-Aj_hoiCSTScEMVspsynE9q1wMvBjlrwceDccJrHg/formResponse";
  const fd=new FormData();

  fd.append("entry.707709000", data.name);      // 닉네임
  fd.append("entry.1389984940", data.gender);   // 성별
  fd.append("entry.513328345", data.age);       // 나이
  fd.append("entry.436383647", data.location);  // 지역
  fd.append("entry.1649771076", data.testName); // 검사명
  fd.append("entry.1905166231", data.score);    // 총점
  fd.append("entry.43237668", data.result);     // 판정결과

  fetch(url,{method:"POST",mode:"no-cors",body:fd})
    .then(()=>console.log("구글폼 전송 성공"))
    .catch(err=>console.error("전송 실패",err));
}
</script>
</body>
</html>
